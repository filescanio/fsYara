rule MAL_RANSOM_LNX_macOS_LockBit_Apr23_1 : hardened limited
{
	meta:
		description = "Detects LockBit ransomware samples for Linux and macOS"
		author = "Florian Roth"
		reference = "https://twitter.com/malwrhunterteam/status/1647384505550876675?s=20"
		date = "2023-04-15"
		hash1 = "0a2bffa0a30ec609d80591eef1d0994d8b37ab1f6a6bad7260d9d435067fb48e"
		hash2 = "9ebcbaf3c9e2bbce6b2331238ab584f95f7ced326ca4aba2ddcc8aa8ee964f66"
		hash3 = "a405d034c01a357a89c9988ffe8a46a165915df18fd297469b2bcaaf97578442"
		hash4 = "c9cac06c9093e9026c169adc3650b018d29c8b209e3ec511bbe34cbe1638a0d8"
		hash5 = "dc3d08480f5e18062a0643f9c4319e5c3f55a2e7e93cd8eddd5e0c02634df7cf"
		hash6 = "e77124c2e9b691dbe41d83672d3636411aaebc0aff9a300111a90017420ff096"
		hash7 = "0be6f1e927f973df35dad6fc661048236d46879ad59f824233d757ec6e722bde"
		hash8 = "3e4bbd21756ae30c24ff7d6942656be024139f8180b7bddd4e5c62a9dfbd8c79"
		score = 85
		id = "c01cb907-7d30-5487-b908-51f69ddb914c"

	strings:
		$x1 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 72 65 73 74 6f 72 65 2d 6d 79 2d 66 69 6c 65 73 2e 74 78 74 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s1 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 6e 74 75 73 65 72 2e 64 61 74 2e 6c 6f 67 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s2 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 62 6f 6f 74 73 65 63 74 2e 62 61 6b (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s3 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 61 75 74 6f 72 75 6e 2e 69 6e 66 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s4 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 6c 6f 63 6b 62 69 74 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$xc1 = { 33 38 36 00 63 6D 64 00 61 6E 69 00 61 64 76 00 6D 73 69 00 6D 73 70 00 63 6F 6D 00 6E 6C 73 }
		$xc2 = { 6E 74 6C 64 72 00 6E 74 75 73 65 72 2E 64 61 74 2E 6C 6F 67 00 62 6F 6F 74 73 65 63 74 2E 62 61 6B }
		$xc3 = { 76 6D 2E 73 74 61 74 73 2E 76 6D 2E 76 5F 66 72 65 65 5F 63 6F 75 6E 74 00 61 2B 00 2F 2A }
		$op1 = { 84 e5 f0 00 f0 e7 10 40 2d e9 2e 10 a0 e3 00 40 a0 e1 ?? fe ff }
		$op2 = { 00 90 a0 e3 40 20 58 e2 3f 80 08 e2 3f 30 c2 e3 09 20 98 e1 08 20 9d }
		$op3 = { 2d e9 01 70 43 e2 07 00 13 e1 01 60 a0 e1 08 d0 4d e2 02 40 }

	condition:
		( uint32be( 0 ) == 0x7f454c46 or uint16( 0 ) == 0xfeca or uint16( 0 ) == 0xfacf or uint32( 0 ) == 0xbebafeca ) and ( 1 of ( $x* ) or 3 of them ) or 2 of ( $x* ) or 5 of them
}

rule MAL_RANSOM_LockBit_Apr23_1 : hardened limited
{
	meta:
		description = "Detects indicators found in LockBit ransomware"
		author = "Florian Roth"
		reference = "https://objective-see.org/blog/blog_0x75.html"
		date = "2023-04-17"
		score = 75
		id = "75dc8b95-16f0-5170-a7d6-fc10bb778348"

	strings:
		$xe1 = {(( 2d 69 20 27 2f 70 61 74 68 2f 74 6f 2f 63 72 79 70 74 27) |( 2c 68 21 26 2e 71 60 75 69 2e 75 6e 2e 62 73 78 71 75 26) |( 2f 6b 22 25 2d 72 63 76 6a 2d 76 6d 2d 61 70 7b 72 76 25) |( 2e 6a 23 24 2c 73 62 77 6b 2c 77 6c 2c 60 71 7a 73 77 24) |( 29 6d 24 23 2b 74 65 70 6c 2b 70 6b 2b 67 76 7d 74 70 23) |( 28 6c 25 22 2a 75 64 71 6d 2a 71 6a 2a 66 77 7c 75 71 22) |( 2b 6f 26 21 29 76 67 72 6e 29 72 69 29 65 74 7f 76 72 21) |( 2a 6e 27 20 28 77 66 73 6f 28 73 68 28 64 75 7e 77 73 20) |( 25 61 28 2f 27 78 69 7c 60 27 7c 67 27 6b 7a 71 78 7c 2f) |( 24 60 29 2e 26 79 68 7d 61 26 7d 66 26 6a 7b 70 79 7d 2e) |( 27 63 2a 2d 25 7a 6b 7e 62 25 7e 65 25 69 78 73 7a 7e 2d) |( 26 62 2b 2c 24 7b 6a 7f 63 24 7f 64 24 68 79 72 7b 7f 2c) |( 21 65 2c 2b 23 7c 6d 78 64 23 78 63 23 6f 7e 75 7c 78 2b) |( 20 64 2d 2a 22 7d 6c 79 65 22 79 62 22 6e 7f 74 7d 79 2a) |( 23 67 2e 29 21 7e 6f 7a 66 21 7a 61 21 6d 7c 77 7e 7a 29) |( 22 66 2f 28 20 7f 6e 7b 67 20 7b 60 20 6c 7d 76 7f 7b 28) |( 3d 79 30 37 3f 60 71 64 78 3f 64 7f 3f 73 62 69 60 64 37) |( 3c 78 31 36 3e 61 70 65 79 3e 65 7e 3e 72 63 68 61 65 36) |( 3f 7b 32 35 3d 62 73 66 7a 3d 66 7d 3d 71 60 6b 62 66 35) |( 3e 7a 33 34 3c 63 72 67 7b 3c 67 7c 3c 70 61 6a 63 67 34) |( 39 7d 34 33 3b 64 75 60 7c 3b 60 7b 3b 77 66 6d 64 60 33) |( 38 7c 35 32 3a 65 74 61 7d 3a 61 7a 3a 76 67 6c 65 61 32) |( 3b 7f 36 31 39 66 77 62 7e 39 62 79 39 75 64 6f 66 62 31) |( 3a 7e 37 30 38 67 76 63 7f 38 63 78 38 74 65 6e 67 63 30) |( 35 71 38 3f 37 68 79 6c 70 37 6c 77 37 7b 6a 61 68 6c 3f) |( 34 70 39 3e 36 69 78 6d 71 36 6d 76 36 7a 6b 60 69 6d 3e) |( 37 73 3a 3d 35 6a 7b 6e 72 35 6e 75 35 79 68 63 6a 6e 3d) |( 36 72 3b 3c 34 6b 7a 6f 73 34 6f 74 34 78 69 62 6b 6f 3c) |( 31 75 3c 3b 33 6c 7d 68 74 33 68 73 33 7f 6e 65 6c 68 3b) |( 30 74 3d 3a 32 6d 7c 69 75 32 69 72 32 7e 6f 64 6d 69 3a) |( 33 77 3e 39 31 6e 7f 6a 76 31 6a 71 31 7d 6c 67 6e 6a 39) |( 32 76 3f 38 30 6f 7e 6b 77 30 6b 70 30 7c 6d 66 6f 6b 38) |( 0d 49 00 07 0f 50 41 54 48 0f 54 4f 0f 43 52 59 50 54 07) |( 0c 48 01 06 0e 51 40 55 49 0e 55 4e 0e 42 53 58 51 55 06) |( 0f 4b 02 05 0d 52 43 56 4a 0d 56 4d 0d 41 50 5b 52 56 05) |( 0e 4a 03 04 0c 53 42 57 4b 0c 57 4c 0c 40 51 5a 53 57 04) |( 09 4d 04 03 0b 54 45 50 4c 0b 50 4b 0b 47 56 5d 54 50 03) |( 08 4c 05 02 0a 55 44 51 4d 0a 51 4a 0a 46 57 5c 55 51 02) |( 0b 4f 06 01 09 56 47 52 4e 09 52 49 09 45 54 5f 56 52 01) |( 0a 4e 07 00 08 57 46 53 4f 08 53 48 08 44 55 5e 57 53 00) |( 05 41 08 0f 07 58 49 5c 40 07 5c 47 07 4b 5a 51 58 5c 0f) |( 04 40 09 0e 06 59 48 5d 41 06 5d 46 06 4a 5b 50 59 5d 0e) |( 07 43 0a 0d 05 5a 4b 5e 42 05 5e 45 05 49 58 53 5a 5e 0d) |( 06 42 0b 0c 04 5b 4a 5f 43 04 5f 44 04 48 59 52 5b 5f 0c) |( 01 45 0c 0b 03 5c 4d 58 44 03 58 43 03 4f 5e 55 5c 58 0b) |( 00 44 0d 0a 02 5d 4c 59 45 02 59 42 02 4e 5f 54 5d 59 0a) |( 03 47 0e 09 01 5e 4f 5a 46 01 5a 41 01 4d 5c 57 5e 5a 09) |( 02 46 0f 08 00 5f 4e 5b 47 00 5b 40 00 4c 5d 56 5f 5b 08) |( 1d 59 10 17 1f 40 51 44 58 1f 44 5f 1f 53 42 49 40 44 17) |( 1c 58 11 16 1e 41 50 45 59 1e 45 5e 1e 52 43 48 41 45 16) |( 1f 5b 12 15 1d 42 53 46 5a 1d 46 5d 1d 51 40 4b 42 46 15) |( 1e 5a 13 14 1c 43 52 47 5b 1c 47 5c 1c 50 41 4a 43 47 14) |( 19 5d 14 13 1b 44 55 40 5c 1b 40 5b 1b 57 46 4d 44 40 13) |( 18 5c 15 12 1a 45 54 41 5d 1a 41 5a 1a 56 47 4c 45 41 12) |( 1b 5f 16 11 19 46 57 42 5e 19 42 59 19 55 44 4f 46 42 11) |( 1a 5e 17 10 18 47 56 43 5f 18 43 58 18 54 45 4e 47 43 10) |( 15 51 18 1f 17 48 59 4c 50 17 4c 57 17 5b 4a 41 48 4c 1f) |( 14 50 19 1e 16 49 58 4d 51 16 4d 56 16 5a 4b 40 49 4d 1e) |( 17 53 1a 1d 15 4a 5b 4e 52 15 4e 55 15 59 48 43 4a 4e 1d) |( 16 52 1b 1c 14 4b 5a 4f 53 14 4f 54 14 58 49 42 4b 4f 1c) |( 11 55 1c 1b 13 4c 5d 48 54 13 48 53 13 5f 4e 45 4c 48 1b) )}
		$xe2 = {(( 68 74 74 70 3a 2f 2f 6c 6f 63 6b 62 69 74) |( 69 75 75 71 3b 2e 2e 6d 6e 62 6a 63 68 75) |( 6a 76 76 72 38 2d 2d 6e 6d 61 69 60 6b 76) |( 6b 77 77 73 39 2c 2c 6f 6c 60 68 61 6a 77) |( 6c 70 70 74 3e 2b 2b 68 6b 67 6f 66 6d 70) |( 6d 71 71 75 3f 2a 2a 69 6a 66 6e 67 6c 71) |( 6e 72 72 76 3c 29 29 6a 69 65 6d 64 6f 72) |( 6f 73 73 77 3d 28 28 6b 68 64 6c 65 6e 73) |( 60 7c 7c 78 32 27 27 64 67 6b 63 6a 61 7c) |( 61 7d 7d 79 33 26 26 65 66 6a 62 6b 60 7d) |( 62 7e 7e 7a 30 25 25 66 65 69 61 68 63 7e) |( 63 7f 7f 7b 31 24 24 67 64 68 60 69 62 7f) |( 64 78 78 7c 36 23 23 60 63 6f 67 6e 65 78) |( 65 79 79 7d 37 22 22 61 62 6e 66 6f 64 79) |( 66 7a 7a 7e 34 21 21 62 61 6d 65 6c 67 7a) |( 67 7b 7b 7f 35 20 20 63 60 6c 64 6d 66 7b) |( 78 64 64 60 2a 3f 3f 7c 7f 73 7b 72 79 64) |( 79 65 65 61 2b 3e 3e 7d 7e 72 7a 73 78 65) |( 7a 66 66 62 28 3d 3d 7e 7d 71 79 70 7b 66) |( 7b 67 67 63 29 3c 3c 7f 7c 70 78 71 7a 67) |( 7c 60 60 64 2e 3b 3b 78 7b 77 7f 76 7d 60) |( 7d 61 61 65 2f 3a 3a 79 7a 76 7e 77 7c 61) |( 7e 62 62 66 2c 39 39 7a 79 75 7d 74 7f 62) |( 7f 63 63 67 2d 38 38 7b 78 74 7c 75 7e 63) |( 70 6c 6c 68 22 37 37 74 77 7b 73 7a 71 6c) |( 71 6d 6d 69 23 36 36 75 76 7a 72 7b 70 6d) |( 72 6e 6e 6a 20 35 35 76 75 79 71 78 73 6e) |( 73 6f 6f 6b 21 34 34 77 74 78 70 79 72 6f) |( 74 68 68 6c 26 33 33 70 73 7f 77 7e 75 68) |( 75 69 69 6d 27 32 32 71 72 7e 76 7f 74 69) |( 76 6a 6a 6e 24 31 31 72 71 7d 75 7c 77 6a) |( 77 6b 6b 6f 25 30 30 73 70 7c 74 7d 76 6b) |( 48 54 54 50 1a 0f 0f 4c 4f 43 4b 42 49 54) |( 49 55 55 51 1b 0e 0e 4d 4e 42 4a 43 48 55) |( 4a 56 56 52 18 0d 0d 4e 4d 41 49 40 4b 56) |( 4b 57 57 53 19 0c 0c 4f 4c 40 48 41 4a 57) |( 4c 50 50 54 1e 0b 0b 48 4b 47 4f 46 4d 50) |( 4d 51 51 55 1f 0a 0a 49 4a 46 4e 47 4c 51) |( 4e 52 52 56 1c 09 09 4a 49 45 4d 44 4f 52) |( 4f 53 53 57 1d 08 08 4b 48 44 4c 45 4e 53) |( 40 5c 5c 58 12 07 07 44 47 4b 43 4a 41 5c) |( 41 5d 5d 59 13 06 06 45 46 4a 42 4b 40 5d) |( 42 5e 5e 5a 10 05 05 46 45 49 41 48 43 5e) |( 43 5f 5f 5b 11 04 04 47 44 48 40 49 42 5f) |( 44 58 58 5c 16 03 03 40 43 4f 47 4e 45 58) |( 45 59 59 5d 17 02 02 41 42 4e 46 4f 44 59) |( 46 5a 5a 5e 14 01 01 42 41 4d 45 4c 47 5a) |( 47 5b 5b 5f 15 00 00 43 40 4c 44 4d 46 5b) |( 58 44 44 40 0a 1f 1f 5c 5f 53 5b 52 59 44) |( 59 45 45 41 0b 1e 1e 5d 5e 52 5a 53 58 45) |( 5a 46 46 42 08 1d 1d 5e 5d 51 59 50 5b 46) |( 5b 47 47 43 09 1c 1c 5f 5c 50 58 51 5a 47) |( 5c 40 40 44 0e 1b 1b 58 5b 57 5f 56 5d 40) |( 5d 41 41 45 0f 1a 1a 59 5a 56 5e 57 5c 41) |( 5e 42 42 46 0c 19 19 5a 59 55 5d 54 5f 42) |( 5f 43 43 47 0d 18 18 5b 58 54 5c 55 5e 43) |( 50 4c 4c 48 02 17 17 54 57 5b 53 5a 51 4c) |( 51 4d 4d 49 03 16 16 55 56 5a 52 5b 50 4d) |( 52 4e 4e 4a 00 15 15 56 55 59 51 58 53 4e) |( 53 4f 4f 4b 01 14 14 57 54 58 50 59 52 4f) |( 54 48 48 4c 06 13 13 50 53 5f 57 5e 55 48) )}
		$s1 = {69 64 65 6c 61 79 69 6e 6d 69 6e}
		$s2 = {62 56 4d 44 4b 6d 6f 64 65}
		$s3 = {62 53 65 6c 66 52 65 6d 6f 76 65}
		$s4 = {69 53 70 6f 74 4d 61 78 69 6d 75 6d}
		$fp1 = {3c 68 74 6d 6c}

	condition:
		(1 of ( $x* ) or 4 of them ) and not 1 of ( $fp* )
}

rule MAL_RANSOM_LockBit_Locker_LOG_Apr23_1 : hardened
{
	meta:
		description = "Detects indicators found in LockBit ransomware log files"
		author = "Florian Roth"
		reference = "https://objective-see.org/blog/blog_0x75.html"
		date = "2023-04-17"
		score = 75
		id = "aa0a2393-e5a2-5151-8afb-91a9bb922179"

	strings:
		$s1 = {20 69 73 20 65 6e 63 72 79 70 74 65 64 2e 20 43 68 65 63 6b 73 75 6d 20 61 66 74 65 72 20 65 6e 63 72 79 70 74 69 6f 6e 20}
		$s2 = {7e 7e 7e 7e 7e 48 61 72 64 77 61 72 65 7e 7e 7e 7e}
		$s3 = {5b 2b 5d 20 41 64 64 20 64 69 72 65 63 74 6f 72 79 20 74 6f 20 65 6e 63 72 79 70 74 3a}
		$s4 = {5d 5b 2b 5d 20 4c 61 75 6e 63 68 20 70 61 72 61 6d 65 74 65 72 73 3a 20}

	condition:
		2 of them
}

rule MAL_RANSOM_LockBit_ForensicArtifacts_Apr23_1 : hardened limited
{
	meta:
		description = "Detects forensic artifacts found in LockBit intrusions"
		author = "Florian Roth"
		reference = "https://objective-see.org/blog/blog_0x75.html"
		date = "2023-04-17"
		score = 75
		id = "e716030c-ee78-51dc-919c-cf59e93da976"

	strings:
		$x1 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 2f 74 6d 70 2f 6c 6f 63 6b 65 72 2e 6c 6f 67 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$x2 = {45 78 65 63 75 74 61 62 6c 65 3d 4c 6f 63 6b 42 69 74 2f 6c 6f 63 6b 65 72 5f}
		$xc1 = { 54 6F 72 20 42 72 6F 77 73 65 72 20 4C 69 6E 6B 73 3A 0D 0A 68 74 74 70 3A 2F 2F 6C 6F 63 6B 62 69 74 }

	condition:
		1 of ( $x* )
}

