rule APT6_Malware_Sample_Gen : FILE hardened
{
	meta:
		description = "Rule written for 2 malware samples that communicated to APT6 C2 servers"
		author = "Florian Roth (Nextron Systems)"
		reference = "https://otx.alienvault.com/pulse/56c4d1664637f26ad04e5b73/"
		date = "2016-04-09"
		modified = "2023-01-06"
		score = 80
		hash1 = "321ec239bfa6927d39155ef5f10741ed786219489bbbb1dc8fee66e22f9f8e80"
		hash2 = "7aef130b19d1f940e4c4cee6efe0f190f1402d2e0f741ee605c77518a04cb6d7"
		id = "142d2714-f7bf-5725-bf7e-9497be7ed234"

	strings:
		$x2 = {53 50 43 4b 21 69 74 20 69 73 20 61 20 5b 28 3f 72 69 64 64 6c 65 3f 29 20 77 72 61 70 70 65 64 20 69 6e 20 61 20 7b 6d 79 73 74 65 72 79 7d 5d 20 69 6e 73 69 64 65 20 61 6e 20 3c 65 6e 69 67 6d 61 3e 21}
		$x3 = {36 33 36 43 37 33 36 39 36 34 33 41 34 36 33 33 34 34 33 30 34 34 33 33 33 36 34 36 32 44 33 32 33 33 34 36 33 38 32 44 33 34 33 36 33 38 33 32 32 44 34 31 33 31 33 39 33 35 32 44 33 37 33 34 34 33 33 39 33 32 34 32 33 30 33 33 34 34 33 34 34 31 34 36}
		$s1 = {4d 6f 7a 69 6c 6c 61 2f 35 2e 30 20 28 63 6f 6d 70 61 74 69 62 6c 65 3b 20 4d 53 49 45 20 39 2e 30 3b 20 57 69 6e 64 6f 77 73 20 4e 54 20 36 2e 31 3b 20 57 4f 57 36 34 3b 20 54 72 69 64 65 6e 74 2f 35 2e 30 29}
		$s2 = {44 55 4d 50 54 48 49 4e}
		$s3 = {22 43 3a 5c 57 49 4e 44 4f 57 53 5c 73 79 73 74 65 6d 33 32 5c}
		$s4 = {77 69 6e 64 6f 77 2e 65 76 61 6c 28 66 2e 64 65 63 6f 64 65 55 52 49 43 6f 6d 70 6f 6e 65 6e 74 28 61 29 29 3b}
		$s5 = {2f 74 62 65 64 72 73 2e 64 6c 6c}
		$s6 = {4e 53 49 53 44 4c 2f 31 2e 32 20 28 4d 6f 7a 69 6c 6c 61 29}
		$s7 = {4e 53 49 53 5f 49 6e 65 74 63 20 28 4d 6f 7a 69 6c 6c 61 29}
		$s8 = {2f 6c 6f 67 6f 73 2e 67 69 66}
		$s9 = {73 79 6e 66 6c 6f 6f 64}
		$s10 = {49 63 6f 6e 46 69 6c 65 3d 43 3a 5c 57 49 4e 44 4f 57 53 5c 73 79 73 74 65 6d 33 32 5c 53 48 45 4c 4c 33 32 2e 64 6c 6c}
		$s11 = {75 64 70 66 6c 6f 6f 64}
		$s12 = {73 68 65 6c 6c 63 6f 64 65}
		$s13 = {26 50 61 73 73 57 6f 72 64 3d}
		$s14 = {53 79 73 74 65 6d 50 72 6f 70 65 72 74 69 65 73 50 72 6f 74 65 63 74 69 6f 6e 2e 65 78 65}
		$s15 = {53 79 73 74 65 6d 50 72 6f 70 65 72 74 69 65 73 52 65 6d 6f 74 65 2e 65 78 65}
		$c1 = {6a 6f 62 63 61 6c 6c 2e 6f 72 67}
		$c2 = {73 70 6f 72 74 73 69 6e 66 69 6e 69 74 65 2e 63 6f 6d}
		$c3 = {6d 69 6c 73 61 74 63 6f 6d 2e 75 73}
		$c4 = {67 65 6f 67 72 61 70 68 69 63 70 68 6f 74 6f 67 72 61 70 68 65 72 2e 63 6f 6d}
		$c5 = {73 6e 6f 77 73 6d 6f 6f 74 68 2e 63 6f 6d}
		$c6 = {67 6f 6f 64 72 65 2e 6e 65 74}
		$c7 = {67 6c 6f 66 6c 61 62 73 2e 63 6f 6d}

	condition:
		( uint16( 0 ) == 0x5a4d and filesize < 1000KB and ( ( 1 of ( $x* ) and 3 of ( $s* ) ) or 1 of ( $c* ) ) ) or ( 6 of them )
}

