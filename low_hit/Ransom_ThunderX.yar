import "pe"

rule Ransom_TunderX : hardened limited
{
	meta:
		description = "Rule to detect tthe ThunderX ransomware family"
		author = "McAfee ATR team"
		date = "2020-09-14"
		rule_version = "v1"
		malware_type = "ransomware"
		malware_family = "Ransomware:W32/ThunderX"
		actor_type = "Cybercrime"
		actor_group = "Unknown"
		hash1 = "7bab5dedef124803668580a59b6bf3c53cc31150d19591567397bbc131b9ccb6"
		hash2 = "0fbfdb8340108fafaca4c5ff4d3c9f9a2296efeb9ae89fcd9210e3d4c7239666"
		hash3 = "7527459500109b3bb48665236c5c5cb2ec71ba789867ad2b6417b38b9a46615e"

	strings:
		$pattern1 = {36 32 36 33 36 34 36 35 36 34 36 39 37 34 32 45 36 35 37 38 36 35 32 30 32 46 37 33 36 35 37 34 32 30 37 42 36 34 36 35 36 36 36 31 37 35 36 43 37 34 37 44 32 30 36 32 36 46 36 46 37 34 37 33 37 34 36 31 37 34 37 35 37 33 37 30 36 46 36 43 36 39 36 33 37 39 32 30 36 39 36 37 36 45 36 46 37 32 36 35 36 31 36 43 36 43 36 36 36 31 36 39 36 43 37 35 37 32 36 35 37 33}
		$s3 = {37 37 36 32 36 31 36 34 36 44 36 39 36 45 32 30 34 34 34 35 34 43 34 35 35 34 34 35 32 30 35 33 35 39 35 33 35 34 34 35 34 44 35 33 35 34 34 31 35 34 34 35 34 32 34 31 34 33 34 42 35 35 35 30 32 30 32 44 36 34 36 35 36 43 36 35 37 34 36 35 34 46 36 43 36 34 36 35 37 33 37 34}
		$s4 = {36 32 36 33 36 34 36 35 36 34 36 39 37 34 32 45 36 35 37 38 36 35 32 30 32 46 37 33 36 35 37 34 32 30 37 42 36 34 36 35 36 36 36 31 37 35 36 43 37 34 37 44 32 30 37 32 36 35 36 33 36 46 37 36 36 35 37 32 37 39 36 35 36 45 36 31 36 32 36 43 36 35 36 34 32 30 34 45 36 46}
		$s5 = {37 37 36 32 36 31 36 34 36 44 36 39 36 45 32 30 34 34 34 35 34 43 34 35 35 34 34 35 32 30 35 33 35 39 35 33 35 34 34 35 34 44 35 33 35 34 34 31 35 34 34 35 34 32 34 31 34 33 34 42 35 35 35 30}
		$s6 = {34 33 33 41 35 43 35 30 37 32 36 46 36 37 37 32 36 31 36 44 32 30 34 36 36 39 36 43 36 35 37 33 32 30 32 38 37 38 33 38 33 36 32 39 35 43 34 44 36 39 36 33 37 32 36 46 37 33 36 46 36 36 37 34 32 30 35 33 35 31 34 43 32 30 35 33 36 35 37 32 37 36 36 35 37 32}
		$s7 = {34 37 36 43 36 46 36 32 36 31 36 43 35 43 33 33 33 35 33 33 33 35 33 35 34 36 34 31 33 35 32 44 33 30 33 37 34 35 33 39 32 44 33 34 33 32 33 38 34 32 32 44 34 32 33 35 34 31 33 35 32 44 33 31 34 33 33 38 33 38 34 33 34 31 34 32 33 32 34 32 33 34 33 38 33 38}
		$s8 = {34 33 33 41 35 43 35 30 37 32 36 46 36 37 37 32 36 31 36 44 32 30 34 36 36 39 36 43 36 35 37 33 35 43 34 44 36 39 36 33 37 32 36 46 37 33 36 46 36 36 37 34 32 30 35 33 35 31 34 43 32 30 35 33 36 35 37 32 37 36 36 35 37 32}
		$s9 = {37 36 37 33 37 33 36 31 36 34 36 44 36 39 36 45 32 45 36 35 37 38 36 35 32 30 34 34 36 35 36 43 36 35 37 34 36 35 32 30 35 33 36 38 36 31 36 34 36 46 37 37 37 33 32 30 32 46 34 31 36 43 36 43 32 30 32 46 35 31 37 35 36 39 36 35 37 34}
		$s10 = {37 37 36 44 36 39 36 33 32 45 36 35 37 38 36 35 32 30 35 33 34 38 34 31 34 34 34 46 35 37 34 33 34 46 35 30 35 39 32 30 32 46 36 45 36 46 36 39 36 45 37 34 36 35 37 32 36 31 36 33 37 34 36 39 37 36 36 35}
		$s11 = {35 33 34 46 34 36 35 34 35 37 34 31 35 32 34 35 35 43 34 44 36 39 36 33 37 32 36 46 37 33 36 46 36 36 37 34 35 43 34 35 35 32 34 39 34 34}
		$s12 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 41 70 70 50 6f 6c 69 63 79 47 65 74 50 72 6f 63 65 73 73 54 65 72 6d 69 6e 61 74 69 6f 6e 4d 65 74 68 6f 64 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s13 = {37 42 35 30 34 31 35 34 35 34 34 35 35 32 34 45 35 46 34 39 34 34 37 44}
		$s14 = {37 32 36 35 36 31 36 34 36 44 36 35 32 45 37 34 37 38 37 34}
		$s15 = {32 32 36 45 36 35 37 34 37 37 36 46 37 32 36 42 32 32 33 41 32 32}
		$s16 = {32 32 37 33 37 35 36 32 36 39 36 34 32 32 33 41 32 32}
		$s17 = {32 32 36 43 36 31 36 45 36 37 32 32 33 41 32 32}
		$s18 = {32 32 36 35 37 38 37 34 32 32 33 41 32 32}
		$s19 = {36 39 36 34 32 45 36 42 36 35 37 39}
		$s20 = {37 42 35 35 34 39 34 34 37 44}
		$seq0 = { eb 34 66 0f 12 0d 10 c4 41 00 f2 0f 59 c1 ba cc }
		$seq1 = { 6a 07 50 e8 51 ff ff ff 8d 86 d0 }
		$seq2 = { ff 15 34 81 41 00 eb 15 83 f8 fc 75 10 8b 45 f4 }

	condition:
		( uint16( 0 ) == 0x5a4d and filesize < 400KB and pe.imphash ( ) == "ea7e408cd2a264fd13492973e97d8d70" and $pattern1 and 4 of them ) and all of ( $seq* ) or ( all of them )
}

