rule EXPL_Shitrix_Exploit_Code_Jan20_1 : FILE hardened limited
{
	meta:
		description = "Detects payloads used in Shitrix exploitation CVE-2019-19781"
		author = "Florian Roth (Nextron Systems)"
		reference = "https://isc.sans.edu/forums/diary/Citrix+ADC+Exploits+Overview+of+Observed+Payloads/25704/"
		date = "2020-01-13"
		score = 70
		id = "7fab3a9b-82a5-573a-b210-2ae65f1a7f24"

	strings:
		$s01 = {2f 6e 65 74 73 63 61 6c 65 72 2f 70 6f 72 74 61 6c 2f 73 63 72 69 70 74 73 2f 72 6d 70 6d 2e 70 6c}
		$s02 = {74 65 65 20 2f 6e 65 74 73 63 61 6c 65 72 2f 70 6f 72 74 61 6c 2f 74 65 6d 70 6c 61 74 65 73 2f}
		$s03 = {65 78 65 63 28 5c 27 28 77 67 65 74 20 2d 71 20 2d 4f 2d 20 68 74 74 70 3a 2f 2f}
		$s04 = {63 64 20 2f 6e 65 74 73 63 61 6c 65 72 2f 70 6f 72 74 61 6c 3b 20 6c 73}
		$s05 = {63 61 74 20 2f 66 6c 61 73 68 2f 6e 73 63 6f 6e 66 69 67 2f 6e 73 2e 63 6f 6e 66}
		$s06 = {2f 6e 65 74 73 63 61 6c 65 72 2f 70 6f 72 74 61 6c 2f 73 63 72 69 70 74 73 2f 50 65 72 73 6f 6e 61 6c 42 6f 6f 6b 6d 61 6b 2e 70 6c}
		$s07 = {74 65 6d 70 6c 61 74 65 2e 6e 65 77 28 7b 27 42 4c 4f 43 4b 27 3d 27 70 72 69 6e 74 20 72 65 61 64 70 69 70 65 28}
		$s08 = {(bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff) 70 77 6e 70 7a 69 31 33 33 37 (bf | a1 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 2a | 2b | 2c | 2d | 2e | 2f | 3a | 3b | 3c | 3d | 3e | 3f | 40 | 5b | 5c | 5d | 5e | 5f | 60 | 7b | 7c | 7d | 7e | 20 | 09 | 0a | 0d | 0b | 0c | 00 | ff)}
		$s09 = {74 65 6d 70 6c 61 74 65 2e 6e 65 77 28 7b 27 42 4c 4f 43 4b 27 3d}
		$s10 = {74 65 6d 70 6c 61 74 65 2e 6e 65 77 28 7b 27 42 4c 4f 43 4b 27 25 33 64}
		$s11 = {6d 79 20 28 24 63 69 74 72 69 78 6d 64 2c 20 25 46 4f 52 4d 29 3b}
		$s12 = {28 43 4d 44 2c 20 22 28 24 63 69 74 72 69 78 6d 64 29 20 32 3e 26 31}
		$b1 = {4e 53 43 5f 55 53 45 52 3a}
		$b2 = {4e 53 43 5f 4e 4f 4e 43 45 3a}
		$b3 = {2f 2e 2e 2f}

	condition:
		1 of ( $s* ) or all of ( $b* )
}

